<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–∫—Ä—ã—Ç—ã—Ö –∫–Ω–æ–ø–æ–∫ Toolbar</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            margin: 0;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 600px;
            position: relative;
        }
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 10000;
        }
        .status.success { background: #28a745; }
        .status.error { background: #dc3545; }
        .status.warning { background: #ffc107; color: #333; }
        .button-test {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .button-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .button-item {
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .button-item.found { background: #d4edda; border-color: #c3e6cb; }
        .button-item.not-found { background: #f8d7da; border-color: #f5c6cb; }
        .button-item.hidden { background: #fff3cd; border-color: #ffeaa7; }
        .button-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .button-name {
            font-weight: bold;
        }
        .button-status {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }
        .status-found { background: #28a745; color: white; }
        .status-not-found { background: #dc3545; color: white; }
        .status-hidden { background: #ffc107; color: #333; }
    </style>
</head>
<body>
    <div id="status" class="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    
    <div class="test-container">
        <h1>–¢–µ—Å—Ç —Å–∫—Ä—ã—Ç—ã—Ö –∫–Ω–æ–ø–æ–∫ Toolbar</h1>
        <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–Ω–æ–ø–∫–∏ "–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏" –∏ "—Ñ—Ä–µ–π–º" —Å–∫—Ä—ã—Ç—ã –≤ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</p>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è toolbar -->
        <div id="toolbar-container" style="position: relative; height: 100px; border: 1px dashed #ccc; margin: 20px 0;"></div>
        
        <!-- –¢–µ—Å—Ç –∫–Ω–æ–ø–æ–∫ -->
        <div class="button-test">
            <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–Ω–æ–ø–æ–∫ –≤ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:</h3>
            <div id="button-test-results"></div>
        </div>
        
        <div id="logs" style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; margin-top: 20px;"></div>
    </div>

    <script type="module">
        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏
        import { Toolbar } from './src/ui/Toolbar.js';
        import { EventBus } from './src/core/EventBus.js';
        
        const status = document.getElementById('status');
        const logs = document.getElementById('logs');
        const toolbarContainer = document.getElementById('toolbar-container');
        const buttonTestResults = document.getElementById('button-test-results');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.innerHTML += `[${timestamp}] ${message}<br>`;
            logs.scrollTop = logs.scrollHeight;
        }
        
        function updateStatus(message, type = 'success') {
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            log('LOG: ' + args.join(' '));
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            log('WARN: ' + args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            log('ERROR: ' + args.join(' '));
        };
        
        async function testHiddenButtons() {
            try {
                log('–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç —Å–∫—Ä—ã—Ç—ã—Ö –∫–Ω–æ–ø–æ–∫...');
                updateStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...', 'warning');
                
                // –°–æ–∑–¥–∞–µ–º EventBus
                const eventBus = new EventBus();
                
                // –°–æ–∑–¥–∞–µ–º Toolbar
                const toolbar = new Toolbar(toolbarContainer, eventBus, 'light');
                
                // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ toolbar —Å–æ–∑–¥–∞–ª—Å—è
                const toolbarElement = toolbarContainer.querySelector('.moodboard-toolbar');
                if (toolbarElement) {
                    log('‚úÖ Toolbar —ç–ª–µ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ');
                    
                    // –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                    const allButtons = [
                        { id: 'select', name: '–í—ã–¥–µ–ª–µ–Ω–∏–µ', shouldExist: true },
                        { id: 'pan', name: '–ü–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ', shouldExist: true },
                        { id: 'text-add', name: '–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç', shouldExist: true },
                        { id: 'note', name: '–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å–∫—É', shouldExist: true },
                        { id: 'image', name: '–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É', shouldExist: true },
                        { id: 'shapes', name: '–§–∏–≥—É—Ä—ã', shouldExist: true },
                        { id: 'pencil', name: '–†–∏—Å–æ–≤–∞–Ω–∏–µ', shouldExist: true },
                        { id: 'comments', name: '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏', shouldExist: false }, // –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∫—Ä—ã—Ç–∞
                        { id: 'attachments', name: '–§–∞–π–ª—ã', shouldExist: true },
                        { id: 'emoji', name: '–≠–º–æ–¥–∂–∏', shouldExist: true },
                        { id: 'frame', name: '–î–æ–±–∞–≤–∏—Ç—å —Ñ—Ä–µ–π–º', shouldExist: false }, // –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∫—Ä—ã—Ç–∞
                        { id: 'clear', name: '–û—á–∏—Å—Ç–∏—Ç—å —Ö–æ–ª—Å—Ç', shouldExist: true },
                        { id: 'undo', name: '–û—Ç–º–µ–Ω–∏—Ç—å', shouldExist: true },
                        { id: 'redo', name: '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å', shouldExist: true }
                    ];
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –∫–Ω–æ–ø–∫—É
                    allButtons.forEach(button => {
                        const buttonElement = toolbarElement.querySelector(`.moodboard-toolbar__button--${button.id}`);
                        const buttonDiv = document.createElement('div');
                        buttonDiv.className = 'button-item';
                        
                        const iconDiv = document.createElement('div');
                        iconDiv.className = 'button-icon';
                        iconDiv.textContent = buttonElement ? '‚úì' : '‚úó';
                        
                        const nameDiv = document.createElement('div');
                        nameDiv.className = 'button-name';
                        nameDiv.textContent = button.name;
                        
                        const statusDiv = document.createElement('div');
                        statusDiv.className = 'button-status';
                        
                        if (buttonElement) {
                            if (button.shouldExist) {
                                buttonDiv.classList.add('found');
                                statusDiv.textContent = '–ù–∞–π–¥–µ–Ω–∞';
                                statusDiv.classList.add('status-found');
                                log(`‚úÖ –ö–Ω–æ–ø–∫–∞ "${button.name}" –Ω–∞–π–¥–µ–Ω–∞ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å)`);
                            } else {
                                buttonDiv.classList.add('hidden');
                                statusDiv.textContent = '–°–∫—Ä—ã—Ç–∞';
                                statusDiv.classList.add('status-hidden');
                                log(`‚ö†Ô∏è –ö–Ω–æ–ø–∫–∞ "${button.name}" –Ω–∞–π–¥–µ–Ω–∞, –Ω–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∫—Ä—ã—Ç–∞!`);
                            }
                        } else {
                            if (button.shouldExist) {
                                buttonDiv.classList.add('not-found');
                                statusDiv.textContent = '–ù–µ –Ω–∞–π–¥–µ–Ω–∞';
                                statusDiv.classList.add('status-not-found');
                                log(`‚ùå –ö–Ω–æ–ø–∫–∞ "${button.name}" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –Ω–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å!`);
                            } else {
                                buttonDiv.classList.add('hidden');
                                statusDiv.textContent = '–°–∫—Ä—ã—Ç–∞';
                                statusDiv.classList.add('status-hidden');
                                log(`‚úÖ –ö–Ω–æ–ø–∫–∞ "${button.name}" —Å–∫—Ä—ã—Ç–∞ (–∫–∞–∫ –∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å)`);
                            }
                        }
                        
                        buttonDiv.appendChild(iconDiv);
                        buttonDiv.appendChild(nameDiv);
                        buttonDiv.appendChild(statusDiv);
                        buttonTestResults.appendChild(buttonDiv);
                    });
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–æ–ø–æ–∫
                    const allButtonElements = toolbarElement.querySelectorAll('.moodboard-toolbar__button');
                    log(`üìä –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–æ–ø–æ–∫ –≤ toolbar: ${allButtonElements.length}`);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–∫—Ä—ã—Ç—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
                    const commentsButton = toolbarElement.querySelector('.moodboard-toolbar__button--comments');
                    const frameButton = toolbarElement.querySelector('.moodboard-toolbar__button--frame');
                    
                    if (!commentsButton && !frameButton) {
                        updateStatus('‚úÖ –ö–Ω–æ–ø–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–∫—Ä—ã—Ç—ã!', 'success');
                        log('‚úÖ –ö–Ω–æ–ø–∫–∏ "–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏" –∏ "—Ñ—Ä–µ–π–º" —É—Å–ø–µ—à–Ω–æ —Å–∫—Ä—ã—Ç—ã');
                    } else {
                        updateStatus('‚ùå –ö–Ω–æ–ø–∫–∏ –Ω–µ —Å–∫—Ä—ã—Ç—ã!', 'error');
                        log('‚ùå –û–¥–Ω–∞ –∏–ª–∏ –æ–±–µ –∫–Ω–æ–ø–∫–∏ –Ω–µ —Å–∫—Ä—ã—Ç—ã');
                    }
                    
                } else {
                    updateStatus('‚ùå Toolbar –Ω–µ —Å–æ–∑–¥–∞–Ω', 'error');
                    log('‚ùå –≠–ª–µ–º–µ–Ω—Ç toolbar –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ');
                }
                
                log('–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω');
                
            } catch (error) {
                updateStatus('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞', 'error');
                log('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ' + error.message);
                console.error('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞:', error);
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç
        testHiddenButtons();
    </script>
</body>
</html>
