<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã Topbar</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            margin: 0;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 600px;
            position: relative;
        }
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 10000;
        }
        .status.success { background: #28a745; }
        .status.error { background: #dc3545; }
        .status.warning { background: #ffc107; color: #333; }
        .icon-test {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .icon-display {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        .icon-name {
            font-weight: bold;
            min-width: 100px;
        }
        .icon-svg {
            width: 24px;
            height: 24px;
            border: 1px solid #ccc;
            padding: 4px;
            border-radius: 4px;
        }
        .status-badge {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-badge.success { background: #d4edda; color: #155724; }
        .status-badge.error { background: #f8d7da; color: #721c24; }
        .status-badge.warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div id="status" class="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    
    <div class="test-container">
        <h1>–¢–µ—Å—Ç –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã Topbar</h1>
        <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∫–æ–Ω–æ–∫ (–∫–∞–∫ –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏)</p>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è topbar -->
        <div id="topbar-container" style="position: relative; height: 100px; border: 1px dashed #ccc; margin: 20px 0;"></div>
        
        <!-- –¢–µ—Å—Ç –∏–∫–æ–Ω–æ–∫ -->
        <div class="icon-test">
            <h3>–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∫–æ–Ω–æ–∫:</h3>
            <div id="icon-test-results"></div>
        </div>
        
        <div id="logs" style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; margin-top: 20px;"></div>
    </div>

    <script type="module">
        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏
        import { Topbar } from './src/ui/Topbar.js';
        import { EventBus } from './src/core/EventBus.js';
        import { Events } from './src/core/events/Events.js';
        import { topbarIconLoader } from './src/utils/topbarIconLoader.js';
        
        const status = document.getElementById('status');
        const logs = document.getElementById('logs');
        const topbarContainer = document.getElementById('topbar-container');
        const iconTestResults = document.getElementById('icon-test-results');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.innerHTML += `[${timestamp}] ${message}<br>`;
            logs.scrollTop = logs.scrollHeight;
        }
        
        function updateStatus(message, type = 'success') {
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            log('LOG: ' + args.join(' '));
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            log('WARN: ' + args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            log('ERROR: ' + args.join(' '));
        };
        
        async function testNewSystem() {
            try {
                log('–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã Topbar...');
                updateStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...', 'warning');
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏–∫–æ–Ω–æ–∫ –Ω–∞–ø—Ä—è–º—É—é
                log('–¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏–∫–æ–Ω–æ–∫ –Ω–∞–ø—Ä—è–º—É—é...');
                const icons = await topbarIconLoader.loadAllIcons();
                
                const iconNames = ['grid-line', 'grid-dot', 'grid-cross', 'grid-off', 'paint'];
                iconNames.forEach(name => {
                    const iconDiv = document.createElement('div');
                    iconDiv.className = 'icon-display';
                    
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'icon-name';
                    nameSpan.textContent = name;
                    
                    const svgContainer = document.createElement('div');
                    svgContainer.className = 'icon-svg';
                    
                    const statusBadge = document.createElement('span');
                    statusBadge.className = 'status-badge';
                    
                    if (icons[name]) {
                        svgContainer.innerHTML = icons[name];
                        statusBadge.textContent = '‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–∞';
                        statusBadge.classList.add('success');
                        log(`‚úÖ –ò–∫–æ–Ω–∫–∞ ${name} –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ`);
                    } else {
                        statusBadge.textContent = '‚úó –ù–µ –Ω–∞–π–¥–µ–Ω–∞';
                        statusBadge.classList.add('error');
                        log(`‚ùå –ò–∫–æ–Ω–∫–∞ ${name} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
                    }
                    
                    iconDiv.appendChild(nameSpan);
                    iconDiv.appendChild(svgContainer);
                    iconDiv.appendChild(statusBadge);
                    iconTestResults.appendChild(iconDiv);
                });
                
                // –°–æ–∑–¥–∞–µ–º EventBus
                const eventBus = new EventBus();
                
                // –°–æ–∑–¥–∞–µ–º Topbar
                const topbar = new Topbar(topbarContainer, eventBus, 'light');
                
                // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ topbar —Å–æ–∑–¥–∞–ª—Å—è
                const topbarElement = topbarContainer.querySelector('.moodboard-topbar');
                if (topbarElement) {
                    log('‚úÖ Topbar —ç–ª–µ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–Ω–æ–ø–∫–∏
                    const buttons = topbarElement.querySelectorAll('.moodboard-topbar__button');
                    log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${buttons.length} –∫–Ω–æ–ø–æ–∫ –≤ topbar`);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∫–æ–Ω–∫–∏
                    const svgIcons = topbarElement.querySelectorAll('svg');
                    log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${svgIcons.length} SVG –∏–∫–æ–Ω–æ–∫`);
                    
                    if (svgIcons.length > 0) {
                        updateStatus('‚úÖ –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
                        log('‚úÖ –ò–∫–æ–Ω–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π');
                    } else {
                        updateStatus('‚ö†Ô∏è –ò–∫–æ–Ω–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'warning');
                        log('‚ö†Ô∏è SVG –∏–∫–æ–Ω–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ topbar');
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                    const rect = topbarElement.getBoundingClientRect();
                    log(`üìç Topbar –ø–æ–∑–∏—Ü–∏—è: left=${rect.left}, top=${rect.top}`);
                    
                    if (rect.left > 0 && rect.top > 0) {
                        log('‚úÖ Topbar –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                    } else {
                        log('‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º topbar');
                    }
                    
                } else {
                    updateStatus('‚ùå Topbar –Ω–µ —Å–æ–∑–¥–∞–Ω', 'error');
                    log('‚ùå –≠–ª–µ–º–µ–Ω—Ç topbar –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ');
                }
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è
                log('–¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è...');
                eventBus.emit(Events.UI.GridChange, { type: 'dot' });
                log('‚úÖ –°–æ–±—ã—Ç–∏–µ GridChange –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
                
                // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                await new Promise(resolve => setTimeout(resolve, 100));
                const activeButton = topbarElement?.querySelector('.moodboard-topbar__button--active');
                if (activeButton) {
                    log('‚úÖ –ê–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –Ω–∞–π–¥–µ–Ω–∞');
                } else {
                    log('‚ö†Ô∏è –ê–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
                
                log('–¢–µ—Å—Ç –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∑–∞–≤–µ—Ä—à–µ–Ω');
                
            } catch (error) {
                updateStatus('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞', 'error');
                log('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ' + error.message);
                console.error('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞:', error);
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç
        testNewSystem();
    </script>
</body>
</html>
